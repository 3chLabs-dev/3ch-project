generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  password_hash String?
  name          String?
  nickname      String?
  phone         String?
  auth_provider String
  provider_id   String?
  created_at    DateTime @default(now())
  updated_at    DateTime @default(now()) @updatedAt

  leagues       League[]      @relation("LeagueCreator")
  teams         Team[]        @relation("TeamCreator")
  created_groups Group[]      @relation("GroupCreator")
  group_memberships GroupMember[]

  @@map("users")
}

model Group {
  id              String    @id @default(uuid())
  name            String    @unique
  description     String?
  sport           String?
  region_city     String?
  region_district String?
  founded_at      DateTime?
  created_at      DateTime  @default(now())
  updated_at      DateTime  @default(now()) @updatedAt

  created_by_id Int
  creator       User    @relation("GroupCreator", fields: [created_by_id], references: [id])

  members     GroupMember[]
  leagues     League[]

  @@map("groups")
}

model GroupMember {
  id         String   @id @default(uuid())
  role       String   @default("member") // "owner", "admin", "member"
  division   String?
  joined_at  DateTime @default(now())

  group_id   String
  group      Group    @relation(fields: [group_id], references: [id], onDelete: Cascade)

  user_id    Int
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([group_id, user_id])
  @@map("group_members")
}

model League {
  id              String    @id @default(uuid())
  name            String
  description     String?
  type            String
  sport           String
  start_date      DateTime
  status          String    @default("draft") // e.g., "draft", "active", "completed"
  rules           String?
  recruit_count   Int       @default(0)
  participant_count Int     @default(0)
  created_at      DateTime  @default(now())
  updated_at      DateTime  @default(now()) @updatedAt

  created_by_id   Int
  creator         User      @relation("LeagueCreator", fields: [created_by_id], references: [id])

  group_id        String?
  group           Group?    @relation(fields: [group_id], references: [id], onDelete: SetNull)

  teams           Team[]
  matches         Match[]
  participants    LeagueParticipant[]

  @@map("leagues")
}

model LeagueParticipant {
  id         String   @id @default(uuid())
  division   String?
  name       String
  paid       Boolean  @default(false)
  arrived    Boolean  @default(false)
  foot_pool  Boolean  @default(false)
  created_at DateTime @default(now())

  league_id  String
  league     League   @relation(fields: [league_id], references: [id], onDelete: Cascade)

  @@index([league_id])
  @@map("league_participants")
}

model Team {
  id              String    @id @default(uuid())
  name            String
  created_at      DateTime  @default(now())
  updated_at      DateTime  @default(now()) @updatedAt

  league_id       String
  league          League    @relation(fields: [league_id], references: [id], onDelete: Cascade)

  created_by_id   Int
  creator         User      @relation("TeamCreator", fields: [created_by_id], references: [id])

  players         Player[]
  home_matches    Match[]   @relation("HomeMatches")
  away_matches    Match[]   @relation("AwayMatches")

  @@map("teams")
}

model Player {
  id              String    @id @default(uuid())
  name            String
  created_at      DateTime  @default(now())
  updated_at      DateTime  @default(now()) @updatedAt

  team_id         String
  team            Team      @relation(fields: [team_id], references: [id], onDelete: Cascade)

  @@map("players")
}

model Match {
  id              String    @id @default(uuid())
  match_date      DateTime
  location        String?
  score_home      Int?
  score_away      Int?
  created_at      DateTime  @default(now())
  updated_at      DateTime  @default(now()) @updatedAt

  league_id       String
  league          League    @relation(fields: [league_id], references: [id], onDelete: Cascade)

  home_team_id    String
  home_team       Team      @relation("HomeMatches", fields: [home_team_id], references: [id])

  away_team_id    String
  away_team       Team      @relation("AwayMatches", fields: [away_team_id], references: [id])

  @@map("matches")
}

